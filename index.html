<!doctype html>
<html>
	<head>
		<title>What's the Color of the Sky in Berlin?</title>
		<meta charset="utf8">
		<meta name="viewport" content="width=device-width">
		<style>
			html, body {
				padding: 0;
				margin: 0;
				color: #333;
			}
			html {
				font-family: sans-serif;
				text-align: center;
				font-size: 12px;
			}
			a {
				color: inherit;
			}
			h1 {
				font-size: 15px;
			}
			strong {
				font-size: 55px;
				display: block;
				position: fixed;
				top: 50%;
				margin-top: -80px;
				width: 100%;
			}
			footer {
				position: fixed;
				bottom: 0;
				width: 100%;
				opacity: .5;
			}
		</style>
		<script>
			var yql = 'http://query.yahooapis.com/v1/public/yql?format=json&callback=imageLoaded&q=',
					query = 'select * from data.uri where url="http://www.met.fu-berlin.de/wetter/webcam/Cam00_prev.jpg"';
					img = new Image,
			    canvas = document.createElement("canvas"),
					ctx = canvas.getContext("2d");

			function init() {
				loadImage();
			}

			function loadImage() {
				var script = document.createElement('script');
				script.src = yql + encodeURIComponent(query);
				document.head.appendChild(script);
			}

			function imageLoaded(response) {
				img.src = response.query.results.url;
			}

			function findNearest(rgb) {
				return colors
					.map(function(color) {
						return {
							d: colorDistance(rgb, color[1]),
							name: color[0]
						};
					})
					.sort(function(color1, color2) {
						return color1.d - color2.d;
					})[0].name;

				for(var i = 0; i < colors.length; i++) {
					if(colorDistance(rgb, colors[i][1]) < 5) {
						return colors[i][0];
					}
				}
			}

			function colorDistance(color1, color2) {
				return Math.sqrt(
						Math.pow(color1[0] - color2[0], 2)
					+ Math.pow(color1[1] - color2[1], 2)
					+ Math.pow(color1[2] - color2[2], 2)
				);
			}

			img.onload = function() {
				canvas.width = img.width;
				canvas.height = img.height;
				ctx.drawImage( img, 0, 0 );

				// slice off the sky
				var padding = 1, cut = .6;
				var data = ctx.getImageData(
						padding, // top
						padding, // left
						img.width - 2 * padding, // width
						Math.round((img.height - 2 * padding) * cut) ).data;

				// calculate average color
				var color = [0, 0, 0];
				for(var i = 0; i < data.length; i += 4) {
					for(var j = 0; j < 3; j++) {
						color[j] += data[i + j];
					}
				}
				var count = data.length / 4;
				color = color.map(function(c) {
						return Math.round(c / count);
				});

				// show color
				document.body.style.background = 'rgb(' + color.join(',') + ')';
				document.body.style.color = 'rgb(' + color.map(function(c) { return 255 - c; }).join(',') + ')';
				var target = document.getElementById('color');
				target.innerHTML = '#' + color.map(function(c) { return c.toString(16); }).join('')
					+ '<br>' + findNearest(color);
			}
		</script>
	</head>
	<body title="Yeah, that's the color of it...">
		<header>
			<h1>What's the Color of the Sky in Berlin?</h1>
		</header>
		<strong id="color">Loading...</strong>
		<footer>
			<p>
				Brought to you by <a href="http://twitter.com/salomvary" target="_blank">@salomvary</a> â€¢
				data source <a href="http://www.met.fu-berlin.de/de/wetter/webcam/" target="_blank">Met FU Berlin</a>
			</p>
		</footer>
<script>
var colors = [
["aliceblue", [240,248,255]],
["antiquewhite", [250,235,215]],
["aqua", [0,255,255]],
["aquamarine", [127,255,212]],
["azure", [240,255,255]],
["beige", [245,245,220]],
["bisque", [255,228,196]],
["black", [0,0,0]],
["blanchedalmond", [255,235,205]],
["blue", [0,0,255]],
["blueviolet", [138,43,226]],
["brown", [165,42,42]],
["burlywood", [222,184,135]],
["cadetblue", [95,158,160]],
["chartreuse", [127,255,0]],
["chocolate", [210,105,30]],
["coral", [255,127,80]],
["cornflowerblue", [100,149,237]],
["cornsilk", [255,248,220]],
["crimson", [220,20,60]],
["cyan", [0,255,255]],
["darkblue", [0,0,139]],
["darkcyan", [0,139,139]],
["darkgoldenrod", [184,134,11]],
["darkgray", [169,169,169]],
["darkgreen", [0,100,0]],
["darkgrey", [169,169,169]],
["darkkhaki", [189,183,107]],
["darkmagenta", [139,0,139]],
["darkolivegreen", [85,107,47]],
["darkorange", [255,140,0]],
["darkorchid", [153,50,204]],
["darkred", [139,0,0]],
["darksalmon", [233,150,122]],
["darkseagreen", [143,188,143]],
["darkslateblue", [72,61,139]],
["darkslategray", [47,79,79]],
["darkslategrey", [47,79,79]],
["darkturquoise", [0,206,209]],
["darkviolet", [148,0,211]],
["deeppink", [255,20,147]],
["deepskyblue", [0,191,255]],
["dimgray", [105,105,105]],
["dimgrey", [105,105,105]],
["dodgerblue", [30,144,255]],
["firebrick", [178,34,34]],
["floralwhite", [255,250,240]],
["forestgreen", [34,139,34]],
["fuchsia", [255,0,255]],
["gainsboro", [220,220,220]],
["ghostwhite", [248,248,255]],
["gold", [255,215,0]],
["goldenrod", [218,165,32]],
["gray", [128,128,128]],
["green", [0,128,0]],
["greenyellow", [173,255,47]],
["grey", [128,128,128]],
["honeydew", [240,255,240]],
["hotpink", [255,105,180]],
["indianred", [205,92,92]],
["indigo", [75,0,130]],
["ivory", [255,255,240]],
["khaki", [240,230,140]],
["lavender", [230,230,250]],
["lavenderblush", [255,240,245]],
["lawngreen", [124,252,0]],
["lemonchiffon", [255,250,205]],
["lightblue", [173,216,230]],
["lightcoral", [240,128,128]],
["lightcyan", [224,255,255]],
["lightgoldenrodyellow", [250,250,210]],
["lightgray", [211,211,211]],
["lightgreen", [144,238,144]],
["lightgrey", [211,211,211]],
["lightpink", [255,182,193]],
["lightsalmon", [255,160,122]],
["lightseagreen", [32,178,170]],
["lightskyblue", [135,206,250]],
["lightslategray", [119,136,153]],
["lightslategrey", [119,136,153]],
["lightsteelblue", [176,196,222]],
["lightyellow", [255,255,224]],
["lime", [0,255,0]],
["limegreen", [50,205,50]],
["linen", [250,240,230]],
["magenta", [255,0,255]],
["maroon", [128,0,0]],
["mediumaquamarine", [102,205,170]],
["mediumblue", [0,0,205]],
["mediumorchid", [186,85,211]],
["mediumpurple", [147,112,219]],
["mediumseagreen", [60,179,113]],
["mediumslateblue", [123,104,238]],
["mediumspringgreen", [0,250,154]],
["mediumturquoise", [72,209,204]],
["mediumvioletred", [199,21,133]],
["midnightblue", [25,25,112]],
["mintcream", [245,255,250]],
["mistyrose", [255,228,225]],
["moccasin", [255,228,181]],
["navajowhite", [255,222,173]],
["navy", [0,0,128]],
["oldlace", [253,245,230]],
["olive", [128,128,0]],
["olivedrab", [107,142,35]],
["orange", [255,165,0]],
["orangered", [255,69,0]],
["orchid", [218,112,214]],
["palegoldenrod", [238,232,170]],
["palegreen", [152,251,152]],
["paleturquoise", [175,238,238]],
["palevioletred", [219,112,147]],
["papayawhip", [255,239,213]],
["peachpuff", [255,218,185]],
["peru", [205,133,63]],
["pink", [255,192,203]],
["plum", [221,160,221]],
["powderblue", [176,224,230]],
["purple", [128,0,128]],
["red", [255,0,0]],
["rosybrown", [188,143,143]],
["royalblue", [65,105,225]],
["saddlebrown", [139,69,19]],
["salmon", [250,128,114]],
["sandybrown", [244,164,96]],
["seagreen", [46,139,87]],
["seashell", [255,245,238]],
["sienna", [160,82,45]],
["silver", [192,192,192]],
["skyblue", [135,206,235]],
["slateblue", [106,90,205]],
["slategray", [112,128,144]],
["slategrey", [112,128,144]],
["snow", [255,250,250]],
["springgreen", [0,255,127]],
["steelblue", [70,130,180]],
["tan", [210,180,140]],
["teal", [0,128,128]],
["thistle", [216,191,216]],
["tomato", [255,99,71]],
["turquoise", [64,224,208]],
["violet", [238,130,238]],
["wheat", [245,222,179]],
["white", [255,255,255]],
["whitesmoke", [245,245,245]],
["yellow", [255,255,0]],
["yellowgreen", [154,205,50]]
];
</script>
<script>init();</script>
	</body>
</html>
